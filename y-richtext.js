!function t(e,r,o){function n(s,u){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return n(r?r:t)},c,c.exports,t,e,r,o)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(t,e,r){var o,n,i,s,u={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=t("./misc.coffee"),o=function(){function t(t){this.editor=t,this.locker=new s.Locker}return t.prototype.getContents=function(){throw new Error("Implement me")},t.prototype.getCursor=function(){throw new Error("Implement me")},t.prototype.setCursor=function(t){throw new Error("Implement me")},t.prototype.removeCursor=function(){throw new Error("Implement me")},t.prototype.removeCursor=function(t){throw new Error("Implement me")},t.prototype.observeLocalText=function(t){throw new Error("Implement me")},t.prototype.observeLocalCursor=function(t){throw new Error("Implement me")},t.prototype.updateContents=function(t){throw new Error("Implement me")},t.prototype.setContents=function(t){throw new Error("Implement me")},t.prototype.getEditor=function(){throw new Error("Implement me")},t.prototype.checkUpdate=function(){throw new Error("Implement me")},t}(),n=function(t){function e(t){this.editor=t,e.__super__.constructor.call(this,this.editor),this._cursors=this.editor.getModule("multi-cursor")}return l(e,t),e.prototype.getLength=function(){return this.editor.getLength()},e.prototype.getCursorPosition=function(){var t;return t=this.editor.getSelection(),t?t.start:0},e.prototype.getContents=function(){return this.editor.getContents().ops},e.prototype.setCursor=function(t){return this.locker["try"](function(e){return function(){var r,o;return r=e._cursors.cursors[t.id],null!=r&&r.color===t.color?o=function(r){return e._cursors.moveCursor(t.id,r)}:(null!=r&&null!=r.color&&r.color!==t.color&&e.removeCursor(t.id),o=function(r){return e._cursors.setCursor(t.id,r,t.text,t.color)}),null!=t.index?o(t.index):void 0}}(this))},e.prototype.removeCursor=function(t){return this._cursors.removeCursor(t)},e.prototype.removeCursor=function(t){return this._cursors.removeCursor(t)},e.prototype.observeLocalText=function(t){return this.editor.on("text-change",function(e,r){var o;return o=t(e.ops),this.editor.selection.emitter.emit(this.editor.selection.emitter.constructor.events.SELECTION_CHANGE,this.editor.quill.getSelection(),"user")})},e.prototype.observeLocalCursor=function(t){return this.editor.on("selection-change",function(e,r){return e&&e.start===e.end?t(e.start):void 0})},e.prototype.updateContents=function(t){return this.editor.updateContents(t)},e.prototype.setContents=function(t){return this.editor.setContents(t)},e.prototype.getEditor=function(){return this.editor},e.prototype.checkUpdate=function(){return this.editor.editor.checkUpdate()},e}(o),i=function(t){function e(t){this.editor=t,e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.getLength=function(){return 0},e.prototype.getCursorPosition=function(){return 0},e.prototype.getContents=function(){return{ops:[{insert:"Well, this is a test!"},{insert:"And I'm boldâ€¦",attributes:{bold:!0}}]}},e.prototype.setCursor=function(){return""},e.prototype.observeLocalText=function(t){return""},e.prototype.observeLocalCursor=function(t){return""},e.prototype.updateContents=function(t){return""},e.prototype.setContents=function(t){return""},e.prototype.getEditor=function(){return this.editor},e}(o),r.QuillJs=n,r.TestEditor=i,r.AbstractEditor=o},{"./misc.coffee":2}],2:[function(t,e,r){var o,n;n=function(){function t(){this.is_locked=!1}return t.prototype["try"]=function(t){var e;if(!this.is_locked)return this.is_locked=!0,e=t(),this.is_locked=!1,e},t}(),o=function(){function t(){this._tmp_model={}}return t.prototype._get=function(t){return null==this._model?this._tmp_model[t]:this._model.val(t)},t.prototype._set=function(t,e){return null==this._model?this._tmp_model[t]=e:this._model.val(t,e)},t.prototype._getModel=function(t,e){var r,o,n;if(null==this._model){this._model=new e.MapManager(this).execute(),n=this._tmp_model;for(r in n)o=n[r],this._model.val(r,o)}return this._model},t.prototype._setModel=function(t){return this._model=t,delete this._tmp_model},t}(),"undefined"!=typeof e&&null!==e&&(r.BaseClass=o,r.Locker=n)},{}],3:[function(t,e,r){var o,n,i,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};if(u=t("./misc.coffee"),o=u.BaseClass,i=u.Locker,n=t("./editors.coffee"),s=function(t){function e(t,e){this.updateCursorPosition=l(this.updateCursorPosition,this),this.passDeltas=l(this.passDeltas,this),this.locker=new i,null!=t&&null!=e&&(this._bind_later={name:t,instance:e})}var r,o,s;return p(e,t),e.prototype.bind=function(){var t,e,r;if(arguments[0]instanceof n.AbstractEditor)this.editor=arguments[0];else{if(r=arguments[0],e=arguments[1],null!=this.editor&&this.editor.getEditor()===e)return;if(t=n[r],null==t)throw new Error("This type of editor is not supported! ("+r+")");this.editor=new t(e)}return this.editor.setContents({ops:this.getDelta()}),this.editor.observeLocalText(this.passDeltas),this.bindEventsToEditor(this.editor),this.editor.observeLocalCursor(this.updateCursorPosition),this._model.connector.receive_handlers.unshift(function(t){return function(){return t.editor.checkUpdate()}}(this))},e.prototype.getDelta=function(){var t,e,r,o,n,i,s,u,l,c;for(i=this._model.getContent("characters").val(),e=0,t=[],n=this._model.getContent("selections"),c=n.getSelections(this._model.getContent("characters")),u=0,l=c.length;l>u;u++){if(r=c[u],o=r.to-r.from+1,e!==r.from&&(s=i.splice(0,r.from-e).join(""),t.push({insert:s}),e+=s.length),e!==r.from)throw new Error("This portion of code must not be reached in getDelta!");t.push({insert:i.splice(0,o).join(""),attributes:r.attrs}),e+=o}return i.length>0&&t.push({insert:i.join("")}),t},e.prototype._getModel=function(t,e){var r,o,i;if(null==this._model){if(o={selections:new t.Selections,characters:new t.List,cursors:new t.Object},this._model=new e.MapManager(this,null,{},o).execute(),this._setModel(this._model),null!=this._bind_later){if(r=n[this._bind_later.name],null==r)throw new Error("This type of editor is not supported! ("+editor_name+") -- fatal error!");i=new r(this._bind_later.instance),this.passDeltas(i.getContents()),this.bind(i),delete this._bind_later}this._model.observe(this.propagateToEditor)}return this._model},e.prototype._setModel=function(t){return e.__super__._setModel.apply(this,arguments)},e.prototype._name="RichText",e.prototype.getText=function(){return this._model.getContent("characters").val().join("")},e.prototype.setCursor=function(t){return this.selfCursor=this._model.getContent("characters").ref(t),this._model.getContent("cursors").val(this._model.HB.getUserId(),this.selfCursor)},e.prototype.passDeltas=function(t){return this.locker["try"](function(e){return function(){var r,n,i,s,u;for(n=0,u=[],i=0,s=t.length;s>i;i++)r=t[i],u.push(n=o(e,r,n));return u}}(this))},e.prototype.updateCursorPosition=function(t){return this.locker["try"](function(e){return function(){return e.selfCursor="number"==typeof t?e._model.getContent("characters").ref(t):t,e._model.getContent("cursors").val(e._model.HB.getUserId(),e.selfCursor)}}(this))},e.prototype.bindEventsToEditor=function(t){return this._model.getContent("characters").observe(function(t){return function(e){return t.locker["try"](function(){var r,o,n,i,s,u,l,c,p;for(s=0,l=e.length;l>s;s++){if(i=e[s],n={ops:[]},i.position>0&&n.ops.push({retain:i.position}),"insert"===i.type)n.ops.push({insert:i.value});else{if("delete"!==i.type)return;for(n.ops.push({"delete":1}),p=t._model.getContent("cursors").val(),o=u=0,c=p.length;c>u;o=++u)r=p[o],o===i.reference&&window.setTimeout(function(){return this._model.getContent("cursors")["delete"](r)},0)}t.editor.updateContents(n)}})}}(this)),this._model.getContent("selections").observe(function(t){return function(e){return t.locker["try"](function(){var r,o,n,i,s,u,l,c,p;if(o={},"select"===e.type){c=e.attrs;for(r in c)s=c[r],o[r]=s}else for(p=e.attrs,u=0,l=p.length;l>u;u++)r=p[u],o[r]=null;return n=e.from.getPosition(),i=e.to.getPosition()-e.from.getPosition()+1,t.editor.updateContents({ops:[{retain:n},{retain:i,attributes:o}]})})}}(this)),this._model.getContent("cursors").observe(function(t){return function(e){return t.locker["try"](function(){var r,o,n,i,s,u,l;for(u=0,l=e.length;l>u;u++)if(o=e[u],"update"===o.type||"add"===o.type){if(r=o.changedBy,s=o.object.val(r),null===s)i=t.editor.getLength();else{if(null==s)return void console.warn("ref_to_char is undefined");if(s.isDeleted())return;i=s.getPosition()}n={id:r,index:i,text:r,color:"grey"},t.editor.setCursor(n)}else t.editor.removeCursor(o.name)})}}(this)),this._model.connector.onUserEvent(function(t){return function(e){return"userLeft"===e.action?t._model.getContent("cursors")["delete"](e.user):void 0}}(this))},o=function(t,e,o){var n,i,u,l,c,p,f,d,h,a,m;if(null==o&&(o=0),null!=e){d=t._model.getContent("selections"),u=[],i={},m=e.attributes;for(p in m)a=m[p],null!=a?i[p]=a:u.push(p);if(null!=e.insert)return c=e.insert,n=function(){if("string"==typeof c)return c.split("");if("number"==typeof c)return[c];throw new Error("Got an unexpected value in delta.insert! ("+typeof content+")")}(),s(t,o,n),l=t._model.getContent("characters").ref(o),h=t._model.getContent("characters").ref(o+n.length-1),t._model.getContent("selections").unselect(l,h,u),t._model.getContent("selections").select(l,h,i,!0),o+n.length;if(null!=e["delete"])return r(t,o,e["delete"]),o;if(null!=e.retain)return f=parseInt(e.retain),l=t._model.getContent("characters").ref(o),h=t._model.getContent("characters").ref(o+f-1),t._model.getContent("selections").unselect(l,h,u),t._model.getContent("selections").select(l,h,i),o+f;throw new Error("This part of code must not be reached!")}},s=function(t,e,r){return t._model.getContent("characters").insertContents(e,r)},r=function(t,e,r){return null==r&&(r=1),t._model.getContent("characters")["delete"](e,r)},e}(o),"undefined"!=typeof window&&null!==window){if(null==window.Y)throw new Error("You must first import Y!");window.Y.RichText=s}"undefined"!=typeof e&&null!==e&&(e.exports=s)},{"./editors.coffee":1,"./misc.coffee":2}]},{},[3]);